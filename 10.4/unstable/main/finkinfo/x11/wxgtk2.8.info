# Fingolfin notes: This packages is not at all in sync with wxmac28, which is a pity.
# Some obvious differences:
# - Name: wxgtk2.8 vs. wxmac28 (not much we can do about this short of renaming one 
#   of the two and updating all dependent packages)
# - different maintainer (OK, not really a problem, but a single maintainer helps to keep
#   the packages in sync. At the very least it would be helpful if the maintainers talked
#   to each other. Before that happens, we need a maintainer for this package, though :)
# - different versions: right now 2.8.0 vs 2.8.3, making *both* oudated ;)
# - DocFiles of the splitoff differ
# - one seems to use expat, the other libxml2 (?!?)
# - wxgtk2.8 has lots and lots of --enable switches (but some of them do nothing).
#   which wxmac28 doesn't have/use. In particular, it seems they were added randomly
#   without a true understanding. For example, it just seems *queer* to use
#   --enable-no_rtti and --enable-no_exceptions, you never want those unless you *must*.
#   They are probably the reason why --enable-stl doesn't work (which in turn is for
#   some users a rather interesting option to use).
### Maybe 'it just seems ...' , but some versions of Apple's libwx were apparently also
### built with -no_rtti; further those flags are NOT the reason for problems with stl. (JFm)
# - wxgtk2.8 seems to build some extra stuff (from contrib/) -- imo either both or none
#   should do this. maybe contrib stuff should go into splitoffs?
# - missing (?) cppunit dependency (one can argue about this one -- no binary difference should be
#   caused by this. But it would be preferable to either always run the unit tests, or never 
#   (the latter achieved by patching configure?)

Package: wxgtk2.8
Version: 2.8.0
Revision: 4
GCC: 4.0
Description: Cross-platform GUI API - unix/gtk version
License: GPL
Maintainer: Gnome Core Team <fink-gnome-core@lists.sourceforge.net>

# + cppunit1.10.2 ?, others ?  Also: no evidence for expat1 from otool or from included (during make) headers 
BuildDepends: <<
	atk1 (>= 1.20.0-1),
	cairo (>= 1.6-1),
	dbus-dev (>= 1.0-1),
	expat1,
	fink (>= 0.24.12-1),
	fontconfig2-dev (>= 2.4.1-1),
	freetype219 (>= 2.3.5-1),
	gconf2-dev (>= 2.20.0-1),
	glib2-dev (>= 2.14.0-1),
	glitz,
	gnome-vfs2-unified-dev (>= 1:2.20.0-1),
	gst-plugins-base-0.10-dev,
	gstreamer-0.10-dev,
	gtk+2-dev (>= 2.12.0-1),
	libbonobo2-dev (>= 2.20.0-1),
	libgettext3-dev,
	libgl,
	libgnomecanvas2-dev (>= 2.20.0-1),
	libgnomeprint2.2-dev (>= 2.18.2-1),
	libgnomeprintui2.2-dev (>= 2.18.1-1),
	libiconv-dev,
	libjpeg,
	libpng3,
	libtiff,
	libxml2 (>= 2.6.30-1),
	orbit2-dev (>= 2.14.9-1),
	pango1-xft2-ft219-dev (>= 1.18.4-4),
	pixman (>= 0.10.0-1),
	pkgconfig (>= 0.21-1),
	x11-dev,
	xft2-dev
<<
Depends: %N-shlibs (= %v-%r)
Conflicts: wxgtk, wxmac, wxmac28
Replaces: wxgtk, wxmac, wxmac28
BuildDependsOnly: True

PatchFile: %n.patch
PatchFile-MD5: 5e3439dfb14d3edf16b248e9995ad3f5
PatchScript: <<
	%{default_script}
  perl -pi -e 's/hardcode_direct=yes/hardcode_direct=no/g' configure
  perl -pi -e 's/single_module/$& -Wl,-x -dead_strip/' build/aclocal/bakefile.m4 configure
  perl -pi -e 's,^extern,#undef BOOL\n$&,' src/unix/displayx11.cpp
# to dispense with '--enable-monolithic' :
  perl -pi -e 's,^\@COND_SHARED_1_USE_XRC_1\@.*\(__WXLIB_BASE_p\)$,$& -lwx_gtk2u_adv-2.8 -lwx_gtk2u_html-2.8,' contrib/src/gizmos/Makefile.in
  perl -pi -e 's;EXTRALIBS_OPENGL=";$&-Wl,-dylib_file,/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib:/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib ;' configure
## uncomment the following to check bdeps  _ (using the command :
## egrep '^\.+ /' wxgtk2.8.log|sort -u|sed -r -e 's,^\.+ ,,'|sort -u|egrep -v '^/usr/(include|lib)/'|xargs dpkg -S 2>/dev/null|cut -f1 -d:|sort -u|xargs
## ):
#  sed -ri -e 's,@CPPFLAGS@,& -H,' {,utils/wxrc/,contrib/src/{gizmos,stc,ogl}/}Makefile.in
<<
Source: mirror:sourceforge:wxwindows/wxWidgets-%v.tar.bz2
Source-MD5: 4bf9c66cdb7cda1d2fe51376c211b9e1

NoSetCPPFLAGS: true
SetCPPFLAGS: -I%p/lib/pango-ft219/include/pango-1.0 -I%p/lib/pango-ft219/include -I%p/lib/freetype219/include/freetype2 -I%p/lib/freetype219/include -I%p/lib/fontconfig2/include -I%p/include -I%p/include/sys
NoSetLDFLAGS: true
SetLDFLAGS: -L%p/lib/pango-ft219/lib -L%p/lib/freetype219/lib -L%p/lib/fontconfig2/lib
SetLIBS: -L%p/lib
SetCFLAGS: -Os
SetCXXFLAGS: -Os
NoSetMAKEFLAGS: true
SetMAKEFLAGS: -j1

# each of the following led to errors (even with --enable-permissive)
# --with-odbc --with-sdl --enable-stl --enable-accessibility
ConfigureParams: <<
  --disable-dependency-tracking \
  --with-gtk --with-gnomeprint --with-gnomevfs --with-freetype --with-opengl \
  --with-expat --with-regex --with-zlib --with-libxpm --with-libtiff --with-libjpeg --with-libpng \
  --enable-optimise --enable-threads --enable-no_rtti --enable-no_exceptions \
  --enable-std_iostreams --enable-std_string --enable-gui --enable-help --enable-docview \
  --enable-unicode --enable-intl --enable-display --enable-geometry --enable-controls --enable-gpe --enable-iff \
  --enable-mediactrl --enable-graphics_ctx --enable-dataviewctrl --enable-tabdialog \
  PKG_CONFIG_PATH="%p/lib/pango-ft219/lib/pkgconfig:%p/lib/fontconfig2/lib/pkgconfig:%p/lib/freetype219/lib/pkgconfig:$PKG_CONFIG_PATH" \
  FREETYPE_CONFIG=%p/lib/freetype219/bin/freetype-config
<<
# try w/o --enable-monolithic
# try w/o "--enable-no_exceptions" to check if rapidsvn builds correctly.. didn't work _ reinstated -no_exceptions
CompileScript: <<
 #!/bin/sh -ev
 export CPATH=%p/include
 cd build
 ../configure %c
 make EXTRALIBS="-lz -lpthread -liconv -lfreetype -lX11 -lXext"
 make -C contrib/src/gizmos
# make -C contrib/src/ogl CXXFLAGS="-DwxUSE_DEPRECATED=0"
# above destroys inherited CXXFLAGS (in particular, -fno-rtti
# hence ensuing missing symbols "typeinfo for..." when linking (eg, libwx_gtk2u_ogl)) _ try without:
 make -C contrib/src/ogl
 make -C contrib/src/stc
<<
InstallScript: <<
 #!/bin/sh -ev
 mkdir -p %i/include
 mkdir -p %i/bin
 cp -R contrib/include/wx %i/include
 cd build
 make DESTDIR=%d install
 make -C contrib/src/gizmos prefix=%i install
 make -C contrib/src/ogl CXXFLAGS="-DwxUSE_DEPRECATED=0" prefix=%i install
 make -C contrib/src/stc prefix=%i install
 make DESTDIR=%d install-wxconfig
 make DESTDIR=%d locale_install
 chmod a-x %i/include/wx-2.8/wx/*.h %i/lib/*
 mkdir -p %i/share/doc
 ln -s %N-shlibs %i/share/doc/%n
<<
SplitOff: <<
 Package: %N-shlibs
 Replaces: %N
	Depends: <<
		gconf2-shlibs (>= 2.20.0-1),
		gst-plugins-base-0.10-shlibs,
		gtk+2-shlibs (>= 2.12.0-1),
		libgettext3-shlibs,
		libiconv,
		libjpeg-shlibs,
		libpng3-shlibs,
		libtiff-shlibs,
		libxml2-shlibs (>= 2.6.30-1),
		orbit2-shlibs (>= 2.14.9-1),
		x11-shlibs
 <<
 Files: lib/libwx_*-*.*.*.dylib
# The following is with '--enable-monolithic'
# Shlibs: <<
#  %p/lib/libwx_gtk2u-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
#  %p/lib/libwx_gtk2u_gizmos-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
#  %p/lib/libwx_gtk2u_gizmos_xrc-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
#  %p/lib/libwx_gtk2u_gl-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
#  %p/lib/libwx_gtk2u_ogl-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
#  %p/lib/libwx_gtk2u_stc-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
# <<
 Shlibs: <<
  %p/lib/libwx_baseu-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_baseu_net-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_baseu_xml-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_adv-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_aui-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_core-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_gizmos-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_gizmos_xrc-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_gl-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_html-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_media-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_ogl-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_qa-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_richtext-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_stc-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
  %p/lib/libwx_gtk2u_xrc-2.8.0.dylib	1.0.0	%n	(>= 2.8.0-1)
 <<
 DocFiles: docs/readme.txt docs/licence.txt docs/changes.txt docs/lgpl.txt docs/gpl.txt
<<

Homepage: http://www.wxwidgets.org/
DescDetail: <<
 In addition to common and advanced GUI facilities such as
 frames, scrolling windows, toolbars, tree controls, icons,
 device contexts, printing, splitter windows and so on, there are
 wrappers for common file operations, and facilities for writing
 TCP/IP applications, thread handling, and more. Where certain
 features are not available on a platform, such as MDI and tree
 controls on Unix, they are emulated.
<<
