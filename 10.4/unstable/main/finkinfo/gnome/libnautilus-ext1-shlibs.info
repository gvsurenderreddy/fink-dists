Package: libnautilus-ext1-shlibs
Version: 2.18.1
Revision: 1

Depends: <<
	atk1-shlibs (>= 1.17.0-1),
	dbus-shlibs (>= 1.0-1),
	gconf2-shlibs (>= 2.16.1-1),
	glib2-shlibs (>= 2.12.0-1),
	gnome-vfs2-unified-shlibs (>= 1:2.17.91-1),
	gtk+2 (>= 2.10.0-1),
	libgettext3-shlibs,
	libhowl-shlibs,
	libiconv,
	libxml2-shlibs (>= 2.6.7-1),
	orbit2 (>= 2.14.7-2),
	pango1-xft2-ft219 (>= 1.16.0-1),
	popt-shlibs,
	x11-shlibs
<<
BuildDepends: <<
	atk1 (>= 1.17.0-1),
	audiofile (>= 0.2.5-1),
	bzip2-dev,
	cairo (>= 1.2-1),
	dbus-dev (>= 1.0-1),
	docbook-utils,
	eel2.2-dev (>= 2.17.90-1),
	esound (>= 0.2.34-1),
	expat1,
	fontconfig2-dev (>= 2.3.2-13),
	freetype219 (>= 2.3.1-1),
	gail18-dev,
	gconf2-dev (>= 2.16.1-1),
	gettext-bin,
	gettext-tools,
	glib2-dev (>= 2.12.0-1),
	glitz,
	gnome-desktop4-dev (>= 2.17.92-1),
	gnome-icon-theme (>= 2.17.91-1),
	gnome-keyring-dev (>= 0.7.92-1),
	gnome-menus2-dev (>= 2.17.92),
	gnome-vfs2-unified-dev (>= 1:2.17.91-1),
	gtk+2-dev (>= 2.10.0-1),
	intltool (>= 0.35.5-1),
	libart2 (>= 2.3.16-1),
	libbonobo2-dev (>= 2.17.92-1),
	libbonoboui2-dev (>= 2.17.94-1),
	libcroco3,
	libexif-dev,
	libgettext3-dev,
	libglade2 (>= 2.6.1-1),
	libgnome2-dev (>= 2.17.92-1),
	libgnomecanvas2-dev (>= 2.14.0-1),
	libgnomeui2-dev (>= 2.17.92-1),
	libgsf-dev,
	libhowl-dev,
	libiconv-dev,
	libjpeg,
	libpng3,
	librsvg2 (>= 2.8.1-1),
	libxml2 (>= 2.6.7-1),
	orbit2-dev (>= 2.14.7-2),
	pango1-xft2-ft219-dev (>= 1.16.0-1),
	pkgconfig (>= 0.21-1),
	popt,
	startup-notification-dev (>= 0.8-1),
	x11-dev,
	xft2-dev
<<

Source: mirror:gnome:sources/nautilus/2.18/nautilus-%v.tar.bz2
Source-MD5: e4718f37080b7d98cd5707e617d43ae6

Patch: %n.patch
ConfigureParams: --disable-schemas-install --disable-update-mimedb --disable-beagle --disable-tracker --disable-dependency-tracking --libdir=%p/lib/libnautilus-ext1 --enable-static PKG_CONFIG_PATH="%p/lib/pango-ft219/lib/pkgconfig:%p/lib/fontconfig2/lib/pkgconfig:%p/lib/freetype219/lib/pkgconfig:$PKG_CONFIG_PATH" FREETYPE_CONFIG=%p/lib/freetype219/bin/freetype-config
NoSetCPPFLAGS: true
SetCPPFLAGS: -I%p/lib/pango-ft219/include/pango-1.0 -I%p/lib/pango-ft219/include -I%p/lib/freetype219/include/freetype2 -I%p/lib/freetype219/include -I%p/lib/fontconfig2/include -I%p/include
NoSetLDFLAGS: true
SetLDFLAGS: -L%p/lib/pango-ft219/lib -L%p/lib/freetype219/lib -L%p/lib/fontconfig2/lib
SetLIBS: -L%p/lib
SetCFLAGS: -Os
SetCXXFLAGS: -Os
InstallScript: <<
	make -j1 install DESTDIR=%d
	/bin/mv %i/lib/libnautilus-ext1/bonobo %i/lib
	/bin/mv %i/lib/libnautilus-ext1/pkgconfig %i/lib
	/bin/ln -s libnautilus-ext1/libnautilus-extension.{a,dylib,la} %i/lib
<<

DocFiles: HACKING TODO THANKS MAINTAINERS README COPYING* ChangeLog po/ChangeLog:ChangeLog.po AUTHORS NEWS

Shlibs: <<
	%p/lib/libnautilus-ext1/libnautilus-extension.1.dylib 2.0.0 %n (>= 2.14.1-1)
<< 

SplitOff: <<
	Package: nautilus
	Depends: <<
		audiofile-shlibs (>= 0.2.5-1),
		bzip2-shlibs,
		eel2.2-shlibs (>= 2.17.90-1),
		esound-bin (>= 0.2.34-1),
		esound-shlibs (>= 0.2.34-1),
		gail18,
		gconf2 (>= 2.16.1-1),
		gnome-desktop (>= 2.17.92-1),
		gnome-keyring-shlibs (>= 0.7.92-1),
		gnome-menus2-shlibs (>= 2.17.92),
		libart2-shlibs (>= 2.3.16-1),
		libbonobo2 (>= 2.17.92-1),
		libbonoboui2 (>= 2.17.94-1),
		libcroco3-shlibs,
		libexif-shlibs,
		libglade2-shlibs (>= 2.6.1-1),
		libgnome2 (>= 2.17.92-1),
		libgnomecanvas2 (>= 2.14.0-1),
		libgnomeui2 (>= 2.17.92-1),
		libgsf-shlibs,
		libjpeg-shlibs,
		libnautilus-ext1-shlibs (>= %v-%r),
		librsvg2-shlibs (>= 2.6.0-1),
		startup-notification-shlibs
	<<
	
	Files: bin etc lib/bonobo share/applications share/locale share/mime share/nautilus share/pixmaps
	ConfFiles: %p/etc/gconf/schemas/apps_nautilus_preferences.schemas
	DocFiles: HACKING TODO THANKS MAINTAINERS README COPYING* ChangeLog po/ChangeLog:ChangeLog.po AUTHORS NEWS
	
	PostInstScript: <<
		if [ configure = "$1" ]; then
			export GCONF_CONFIG_SOURCE=`gconftool-2 --get-default-source`
			gconftool-2 --makefile-install-rule %p/etc/gconf/schemas/apps_nautilus_preferences.schemas >/dev/null
		fi
		[ -x %p/bin/update-mime-database ] && update-mime-database %p/share/mime > /dev/null 2>&1 || :
	<<
	PostRmScript: <<
		[ -x %p/bin/update-mime-database ] && update-mime-database %p/share/mime > /dev/null 2>&1 || :
	<<
	DescDetail: <<
		Nautilus is an open-source file manager and graphical 
		shell being developed by Eazel, Inc. and others. It 
		is part of the GNOME project, and its source code can 
		be found in the GNOME CVS repository. 
	<<
	DescUsage: <<
		If you are running X rootless, launch Nautilus with
		'--no-desktop' flag, so it doesn't take over root
		window.
		
		Known bugs:
		Not really a bug, but Nautilus knows nothing about
		resource forks, Mac applications, bundles, etc. So
		beware! Certain actions (like moving a file with a
		rsource fork to another disk) may damage your data.
	<<
<<

SplitOff2: <<
	Package: libnautilus-ext1-dev
	Depends: libnautilus-ext1-shlibs (= %v-%r)
	Conflicts: nautilus-dev
	Replaces: nautilus-dev
	BuildDependsOnly: true
	Files: <<
		lib/libnautilus-ext1/libnautilus-extension.{a,dylib,la}
		lib/libnautilus-extension.{a,dylib,la}
		lib/pkgconfig include
	<<
	DocFiles: HACKING TODO THANKS MAINTAINERS README COPYING* ChangeLog po/ChangeLog:ChangeLog.po AUTHORS NEWS
	DescDetail: <<
		libnautilus-ext1-(dev,shlibs) is a modern replacement
		for nautilus-(dev,shlibs), which is no longer part of
		recent versions of nautilus.
	<<
<<

Description: Next-generation GNOME 2 file manager
DescDetail: <<
	libnautilus-ext1-(dev,shlibs) is a modern replacement
	for nautilus-(dev,shlibs), which is no longer part of
	recent versions of nautilus.
<<
DescPort: <<
	Fix missing #include in libnautilus-private/nautilus-emblem-utils.c.
	See: http://bugzilla.gnome.org/show_bug.cgi?id=348300

	Remove inappropriate flag from libnautilus-private/Makefile.
	See: http://bugzilla.gnome.org/show_bug.cgi?id=348301

	TODO: The usual **environ fix? See:
	http://bugzilla.gnome.org/show_bug.cgi?id=344197
diff -Nurd -x'*~' nautilus-2.14.1.orig/libnautilus-private/nautilus-program-choosing.c nautilus-2.14.1/libnautilus-private/nautilus-program-choosing.c
--- nautilus-2.14.1.orig/libnautilus-private/nautilus-program-choosing.c	2006-03-18 01:45:15.000000000 -0500
+++ nautilus-2.14.1/libnautilus-private/nautilus-program-choosing.c	2006-06-07 15:44:29.000000000 -0400
@@ -61,7 +61,8 @@
 #include <gdk/gdkx.h>
 #endif
 
-extern char **environ;
+#include <crt_externs.h>
+#define environ (*_NSGetEnviron())
 
 /* Cut and paste from gdkspawn-x11.c */
 static gchar **
<<
DescPackaging: <<
	Old nautilus-shlibs had libnautilus-extension.1.dylib library in
	%p/lib. But it also had other libraries that are no longer present,
	so can't keep the same fink packagename. to avoid conflicts or
	breaking things that need nautilus-shlibs libs, we rename package
	and move libs.
<<

License: GPL
Maintainer: The Gnome Core Team <fink-gnome-core@lists.sourceforge.net>
Homepage: http://nautilus.eazel.com
