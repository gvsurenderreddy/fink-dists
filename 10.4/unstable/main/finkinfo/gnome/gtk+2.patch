
--- gtk+-2.10.3/Makefile.in	2006-09-04 22:40:05.000000000 -0400
+++ gtk+-2.10.3-patched/Makefile.in	2006-09-12 13:07:49.000000000 -0400
@@ -292,7 +292,7 @@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
 
-SRC_SUBDIRS = gdk-pixbuf gdk gtk modules demos tests perf contrib
+SRC_SUBDIRS = gdk-pixbuf gdk gtk modules       tests perf contrib
 SUBDIRS = po po-properties $(SRC_SUBDIRS) docs m4macros
 
 # require automake 1.4
--- gtk+-2.10.3/configure.in	2006-09-01 14:11:19.000000000 -0400
+++ gtk+-2.10.3-patched/configure.in	2006-09-12 13:07:13.000000000 -0400
@@ -1119,7 +1119,7 @@
 
     GDK_PIXBUF_XLIB_EXTRA_CFLAGS="$x_cflags"
     GDK_PIXBUF_XLIB_EXTRA_LIBS="$X_LIBS -lX11 $X_EXTRA_LIBS"
-    GTK_DEP_LIBS_FOR_X="$X_LIBS -lXrender -lX11 $X_EXTRA_LIBS"
+    GTK_DEP_LIBS_FOR_X="$X_LIBS -lXrender -lX11 -lfontconfig $X_EXTRA_LIBS"
   fi
 
   # Extra libraries found during checks (-lXinerama, etc), not from pkg-config.
--- gtk+-2.10.3/docs/tools/shooter.c	2004-11-16 00:10:18.000000000 -0500
+++ gtk+-2.10.3-patched/docs/tools/shooter.c	2006-09-12 13:20:49.000000000 -0400
@@ -16,7 +16,11 @@
 #include <stdlib.h>
 #include <fcntl.h>
 #include <errno.h>
+#if defined(X_LOCALE)
+#include <X11/Xlocale.h>
+#else
 #include <locale.h>
+#endif
 #include "widgets.h"
 #include "shadow.h"
 
--- gtk+-2.10.3/gdk/directfb/gdkim-directfb.c	2006-02-04 23:04:28.000000000 -0500
+++ gtk+-2.10.3-patched/gdk/directfb/gdkim-directfb.c	2006-09-12 13:20:52.000000000 -0400
@@ -33,7 +33,11 @@
 #include "config.h"
 
 #include <string.h>
+#if defined(X_LOCALE)
+#include <X11/Xlocale.h>
+#else
 #include <locale.h>
+#endif
 
 #include "gdkdirectfb.h"
 
--- gtk+-2.10.3/gdk/linux-fb/gdkim-fb.c	2001-10-10 17:54:25.000000000 -0400
+++ gtk+-2.10.3-patched/gdk/linux-fb/gdkim-fb.c	2006-09-12 13:20:56.000000000 -0400
@@ -35,7 +35,11 @@
 #  endif
 #endif
 
+#if defined(X_LOCALE)
+#include <X11/Xlocale.h>
+#else
 #include <locale.h>
+#endif
 
 /*
  *--------------------------------------------------------------
--- gtk+-2.10.3/gdk/x11/gdkdrawable-x11.c	2006-08-15 13:05:00.000000000 -0400
+++ gtk+-2.10.3-patched/gdk/x11/gdkdrawable-x11.c	2006-09-12 13:10:05.000000000 -0400
@@ -959,11 +959,19 @@
    * RENDER's preferred order
    */
   pf.direct.alphaMask = 0;
-  /* ARGB */
-  pf.direct.red = 16;
-  pf.direct.green = 8;
-  pf.direct.blue = 0;
-  
+  if (ImageByteOrder (xdisplay) == LSBFirst)
+    {
+      /* ARGB */
+      pf.direct.red = 16;
+      pf.direct.green = 8;
+      pf.direct.blue = 0;
+    } else {
+      /* BGRA */
+      pf.direct.red = 8;
+      pf.direct.green = 16;
+      pf.direct.blue = 24;
+    }
+
   *format = XRenderFindFormat (xdisplay,
 			       (PictFormatType | PictFormatDepth |
 				PictFormatRedMask | PictFormatRed |
@@ -974,7 +982,14 @@
 			       0);
 
   pf.direct.alphaMask = 0xff;
-  pf.direct.alpha = 24;
+  if (ImageByteOrder (xdisplay) == LSBFirst)
+    {
+      /* ARGB */
+      pf.direct.alpha = 24;
+    } else {
+      /* BGRA */
+      pf.direct.alpha = 0;
+    }
   
   *mask = XRenderFindFormat (xdisplay,
 			     (PictFormatType | PictFormatDepth |
@@ -991,11 +1006,19 @@
 
   pf.type = PictTypeDirect;
   pf.depth = 32;
-  pf.direct.red = 16;
-  pf.direct.green = 8;
-  pf.direct.blue = 0;
+  if (ImageByteOrder (xdisplay) == LSBFirst)
+    {
+      pf.direct.red = 16;
+      pf.direct.green = 8;
+      pf.direct.blue = 0;
+      pf.direct.alpha = 24;
+    } else {
+      pf.direct.red = 8;
+      pf.direct.green = 16;
+      pf.direct.blue = 24;
+      pf.direct.alpha = 0;
+    }
   pf.direct.alphaMask = 0xff;
-  pf.direct.alpha = 24;
 
   *format = XRenderFindFormat (xdisplay,
 			       (PictFormatType | PictFormatDepth |
--- gtk+-2.10.3/gdk/x11/gdkfont-x11.c	2006-06-04 21:14:57.000000000 -0400
+++ gtk+-2.10.3-patched/gdk/x11/gdkfont-x11.c	2006-09-12 13:12:59.000000000 -0400
@@ -29,7 +29,11 @@
 #include <config.h>
 #include <X11/Xlib.h>
 #include <X11/Xos.h>
+#if defined(X_LOCALE)
+#include <X11/Xlocale.h>
+#else
 #include <locale.h>
+#endif
 
 #include "gdkx.h"
 #include "gdkfont.h"
--- gtk+-2.10.3/gdk/x11/gdkim-x11.c	2006-02-24 07:28:33.000000000 -0500
+++ gtk+-2.10.3-patched/gdk/x11/gdkim-x11.c	2006-09-12 13:21:08.000000000 -0400
@@ -26,7 +26,11 @@
 
 #include <config.h>
 
+#if defined(X_LOCALE)
+#include <X11/Xlocale.h>
+#else
 #include <locale.h>
+#endif
 #include <stdlib.h>
 #include <string.h>
 
--- gtk+-2.10.3/gdk/x11/gdkspawn-x11.c	2005-03-15 22:17:27.000000000 -0500
+++ gtk+-2.10.3-patched/gdk/x11/gdkspawn-x11.c	2006-09-12 13:11:04.000000000 -0400
@@ -28,7 +28,12 @@
 #include <gdk/gdk.h>
 #include "gdkalias.h"
 
+#ifdef __APPLE__
+#include <crt_externs.h>
+#define environ (*_NSGetEnviron())
+#else
 extern char **environ;
+#endif
 
 /**
  * gdk_make_spawn_environment_for_screen:
--- gtk+-2.10.3/gtk/gtkimmulticontext.c	2006-05-14 00:25:29.000000000 -0400
+++ gtk+-2.10.3-patched/gtk/gtkimmulticontext.c	2006-09-12 13:21:13.000000000 -0400
@@ -20,7 +20,11 @@
 #include <config.h>
 
 #include <string.h>
+#if defined(X_LOCALE)
+#include <X11/Xlocale.h>
+#else
 #include <locale.h>
+#endif
 
 #include "gtkimmulticontext.h"
 #include "gtkimmodule.h"
--- gtk+-2.10.3/gtk/gtkmain.c	2006-09-03 01:31:21.000000000 -0400
+++ gtk+-2.10.3-patched/gtk/gtkmain.c	2006-09-12 13:13:16.000000000 -0400
@@ -29,7 +29,11 @@
 #include <glib.h>
 #include "gdkconfig.h"
 
+#if defined(X_LOCALE)
+#include <X11/Xlocale.h>
+#else
 #include <locale.h>
+#endif
 
 #ifdef HAVE_BIND_TEXTDOMAIN_CODESET
 #include <libintl.h>
--- gtk+-2.10.3/gtk/gtkpagesetupunixdialog.c	2006-06-14 12:48:07.000000000 -0400
+++ gtk+-2.10.3-patched/gtk/gtkpagesetupunixdialog.c	2006-09-12 13:13:19.000000000 -0400
@@ -20,7 +20,11 @@
 
 #include "config.h"
 #include <string.h>
+#if defined(X_LOCALE)
+#include <X11/Xlocale.h>
+#else
 #include <locale.h>
+#endif
 
 #ifdef HAVE__NL_MEASUREMENT_MEASUREMENT
 #include <langinfo.h>
--- gtk+-2.10.3/gtk/gtkpapersize.c	2006-07-10 12:36:10.000000000 -0400
+++ gtk+-2.10.3-patched/gtk/gtkpapersize.c	2006-09-12 13:13:24.000000000 -0400
@@ -21,7 +21,11 @@
 #include "config.h"
 #include <string.h>
 #include <stdlib.h>
+#if defined(X_LOCALE)
+#include <X11/Xlocale.h>
+#else
 #include <locale.h>
+#endif
 #if defined(HAVE__NL_PAPER_HEIGHT) && defined(HAVE__NL_PAPER_WIDTH)
 #include <langinfo.h>
 #endif
--- gtk+-2.10.3/gtk/gtkrc.c	2006-09-04 07:25:17.000000000 -0400
+++ gtk+-2.10.3-patched/gtk/gtkrc.c	2006-09-12 13:21:24.000000000 -0400
@@ -26,7 +26,11 @@
 
 #include <config.h>
 
+#if defined(X_LOCALE)
+#include <X11/Xlocale.h>
+#else
 #include <locale.h>
+#endif
 #ifdef HAVE_UNISTD_H
 #include <unistd.h>
 #endif
--- gtk+-2.10.3/gtk/gtkspinbutton.c	2006-08-15 14:52:14.000000000 -0400
+++ gtk+-2.10.3-patched/gtk/gtkspinbutton.c	2006-09-12 13:21:27.000000000 -0400
@@ -32,7 +32,11 @@
 #include <stdlib.h>
 #include <math.h>
 #include <string.h>
+#if defined(X_LOCALE)
+#include <X11/Xlocale.h>
+#else
 #include <locale.h>
+#endif
 #include "gdk/gdkkeysyms.h"
 #include "gtkbindings.h"
 #include "gtkspinbutton.h"
--- gtk+-2.10.3/gtk/gtkwidget.c	2006-07-21 10:52:05.000000000 -0400
+++ gtk+-2.10.3-patched/gtk/gtkwidget.c	2006-09-12 13:21:42.000000000 -0400
@@ -27,7 +27,11 @@
 #include <config.h>
 #include <stdarg.h>
 #include <string.h>
+#if defined(X_LOCALE)
+#include <X11/Xlocale.h>
+#else
 #include <locale.h>
+#endif
 #include "gtkcontainer.h"
 #include "gtkaccelmap.h"
 #include "gtkclipboard.h"
--- gtk+-2.10.3/gtk/xdgmime/xdgmimecache.c	2005-12-01 14:04:41.000000000 -0500
+++ gtk+-2.10.3-patched/gtk/xdgmime/xdgmimecache.c	2006-09-12 13:14:28.000000000 -0400
@@ -46,6 +46,10 @@
 #include <sys/stat.h>
 #include <sys/types.h>
 
+#ifdef HAVE_STDINT_H
+#include <stdint.h>
+#endif
+
 #include "xdgmimecache.h"
 #include "xdgmimeint.h"
 
--- gtk+-2.10.3/modules/input/Makefile.in	2006-09-04 22:40:12.000000000 -0400
+++ gtk+-2.10.3-patched/modules/input/Makefile.in	2006-09-12 13:16:22.000000000 -0400
@@ -807,25 +807,13 @@
 # install-data-am, and not install-exec-am. We need to ensure this gets run
 # after the libraries are installed in their final locations.
 install-data-hook:
-	@if $(RUN_QUERY_IMMODULES_TEST) ; then \
-	  echo $(mkinstalldirs) $(DESTDIR)$(sysconfdir)/gtk-2.0 ; \
-	  $(mkinstalldirs) $(DESTDIR)$(sysconfdir)/gtk-2.0 ; \
-	  echo "$(top_builddir)/gtk/gtk-query-immodules-2.0 > $(DESTDIR)$(sysconfdir)/gtk-2.0/gtk.immodules" ; \
-	  $(top_builddir)/gtk/gtk-query-immodules-2.0 > $(DESTDIR)$(sysconfdir)/gtk-2.0/gtk.immodules ; \
-	else \
-	  echo "***" ; \
-	  echo "*** Warning: gtk.immodules not built" ; \
-	  echo "***" ; \
-	  echo "*** Generate this file manually on host" ; \
-	  echo "*** system using gtk-query-immodules-2.0" ; \
-	  echo "***" ; \
-        fi
+	$(mkinstalldirs) $(DESTDIR)$(sysconfdir)/gtk-2.0
 
 uninstall-local:
 	rm -f $(DESTDIR)$(sysconfdir)/gtk-2.0/gtk.immodules
 
 gtk.immodules: Makefile.am $(module_LTLIBRARIES)
-	$(top_builddir)/gtk/gtk-query-immodules-2.0 $(module_LTLIBRARIES) > gtk.immodules
+#	$(top_builddir)/gtk/gtk-query-immodules-2.0 $(module_LTLIBRARIES) > gtk.immodules
 
 @CROSS_COMPILING_FALSE@all-local: gtk.immodules
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
--- gtk+-2.10.3/modules/input/gtkimcontextxim.c	2005-06-30 14:42:44.000000000 -0400
+++ gtk+-2.10.3-patched/modules/input/gtkimcontextxim.c	2006-09-12 13:21:40.000000000 -0400
@@ -18,7 +18,11 @@
  */
 
 #include <config.h>
-#include "locale.h"
+#if defined(X_LOCALE)
+#include <X11/Xlocale.h>
+#else
+#include <locale.h>
+#endif
 #include <string.h>
 #include <stdlib.h>
 
--- gtk+-2.10.3/po/Makefile.in.in	2006-07-23 16:19:18.000000000 -0400
+++ gtk+-2.10.3-patched/po/Makefile.in.in	2006-09-12 13:16:40.000000000 -0400
@@ -27,7 +27,7 @@
 exec_prefix = @exec_prefix@
 datadir = @datadir@
 libdir = @libdir@
-localedir = $(libdir)/locale
+localedir = $(datadir)/locale
 gnulocaledir = $(datadir)/locale
 gettextsrcdir = $(datadir)/glib-2.0/gettext/po
 subdir = po
--- gtk+-2.10.3/tests/testicontheme.c	2005-07-13 01:44:22.000000000 -0400
+++ gtk+-2.10.3-patched/tests/testicontheme.c	2006-09-12 13:21:38.000000000 -0400
@@ -21,7 +21,11 @@
 #include <gtk/gtk.h>
 #include <stdlib.h>
 #include <string.h>
+#if defined(X_LOCALE)
+#include <X11/Xlocale.h>
+#else
 #include <locale.h>
+#endif
 
 static void
 usage (void)
--- gtk+-2.10.3/update-gdk-pixbuf-loaders	1969-12-31 19:00:00.000000000 -0500
+++ gtk+-2.10.3-patched/update-gdk-pixbuf-loaders	2006-09-12 13:16:43.000000000 -0400
@@ -0,0 +1,21 @@
+#!/bin/sh -e
+#
+# update-gdk-pixbuf-loaders
+#
+#   Packages which install gdk-pixbuf loader(s) should call update-gdk-
+#   pixbuf-loaders in their PostInstScript and PostRmScript to update the
+#   gdk-pixbuf.loaders file.
+#
+
+CONFDIR=@PREFIX@/etc/gtk-2.0
+CONFFILE=$CONFDIR/gdk-pixbuf.loaders
+
+mkdir -p $CONFDIR
+
+TMPFILE=`tempfile`
+gdk-pixbuf-query-loaders >$TMPFILE
+
+mv -f $TMPFILE $CONFFILE
+chmod 0644 $CONFFILE
+
+exit 0
--- gtk+-2.10.3/update-gtk-immodules	1969-12-31 19:00:00.000000000 -0500
+++ gtk+-2.10.3-patched/update-gtk-immodules	2006-09-12 13:16:56.000000000 -0400
@@ -0,0 +1,20 @@
+#!/bin/sh -e
+#
+# update-gtk-immodules
+#
+#   Packages which install gtk immodule(s) should call update-gtk-immodules
+#   in their PostInstScript and PostRmScript to update the gtk.immodules file.
+#
+
+CONFDIR=@PREFIX@/etc/gtk-2.0
+CONFFILE=$CONFDIR/gtk.immodules
+
+mkdir -p $CONFDIR
+
+TMPFILE=`tempfile`
+gtk-query-immodules-2.0 >$TMPFILE
+
+mv -f $TMPFILE $CONFFILE
+chmod 0644 $CONFFILE
+
+exit 0
